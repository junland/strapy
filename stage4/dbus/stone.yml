name        : dbus
version     : 1.12.20
release     : 1
summary     : D-Bus Message Bus System
license     :
    - AFL-2.1
    - GPL-2.0-or-later
homepage    : https://www.freedesktop.org/wiki/Software/dbus
description : |
    D-Bus Message Bus System
upstreams   :
    - https://dbus.freedesktop.org/releases/dbus/dbus-1.12.20.tar.gz: f77620140ecb4cdc67f37fb444f8a6bea70b5b6461f12f1cbe2cec60fa7de5fe
setup       : |
    %configure
build       : |
    %make
install     : |
    %make_install

    # dbus-broker handles dbus in Serpent OS, remove dbus equivalent
    rm "%(installroot)/usr/bin/dbus-daemon"
    rm -rf  "%(installroot)/usr/lib/systemd"

    # Stateless: /etc/dbus-1 is no longer used
    # /var/{lib,run}/dbus are created by tmpfiles
    rm %(installroot)/etc/dbus-1/*
    rmdir %(installroot)/etc/{dbus-1,}
    rmdir %(installroot)/var/{lib/dbus,lib,run/dbus,run,}

    # Need to ensure /var/run becomes a symlink to /run for compatibility
    %tmpfiles "# Create /var/run/dbus directory"
    %tmpfiles "d /var/run/dbus 0755 - - -"
